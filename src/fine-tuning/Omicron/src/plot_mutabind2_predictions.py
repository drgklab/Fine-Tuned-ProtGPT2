#!/usr/bin/env python
#
# Plot MutaBind2 predictions for variants generated by finetuned ProtGPT2 model.
#

import seaborn as sns
import pandas as pd
import matplotlib.pyplot as plt

################################################################################
## Build Output Scaffolding
################################################################################

os.makedirs('./calc', exist_ok=True)
os.makedirs('./fig', exist_ok=True)

################################################################################
## Load Data
################################################################################

# mutabind2 predictions
pred_7df4 = pd.read_csv('./data/7DF4_StoACE2.tsv', sep='\t', comment='#')
pred_8d8q_2130 = pd.read_csv('./data/8D8Q_Sto2130.tsv', sep='\t', comment='#')
pred_8d8q_2196 = pd.read_csv('./data/8D8Q_Sto2196.tsv', sep='\t', comment='#')

# variant metadata
meta_df = pd.read_csv('./calc/variant_meta_df.csv')

################################################################################
## Build Plots
################################################################################

plot_df = pred_7df4.loc[:,['Mutation', 'DDG']].merge(
    pred_8d8q_2130.loc[:,['Mutation', 'DDG']],
    suffixes=('_7df4', '_8d8q'),
    on='Mutation'
).merge(meta_df, on='Mutation')

sns.scatterplot(data=plot_df,
    x="DDG_7df4", y="DDG_8d8q",
    hue='prediction_identity')

def label_point(x, y, val, ax):
    a = pd.concat({'x': x, 'y': y, 'val': val}, axis=1)
    for i, point in a.iterrows():
        ax.text(point['x']+.02, point['y'], str(point['val']))


label_point(
    plot_df['DDG_7df4'],
    plot_df['DDG_8d8q'],
    plot_df['Mutation'], plt.gca())



